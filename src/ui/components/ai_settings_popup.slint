import {
    Button,
    VerticalBox,
    HorizontalBox,
    LineEdit,
    ComboBox,
} from "std-widgets.slint";
import { Theme } from "../styles.slint";

export component AISettingsPopup inherits Rectangle {
    visible: false; // Default to hidden, controlled by parent
    background: #00000080; // Semi-transparent overlay
    
    in-out property <string> ai-settings-status;
    in-out property <string> ai-provider;
    in-out property <string> ai-api-key;

    callback save-ai-key(string, string);
    callback close-ai-settings();
    callback ai-provider-changed(string);

    TouchArea { // Block clicks
    }

    Rectangle {
        width: 400px;
        height: 350px;
        background: Theme.editor-bg;
        border-color: Theme.border;
        border-width: 1px;
        border-radius: 4px;
        VerticalBox {
            padding: 16px;
            spacing: 12px;
            Text {
                text: "ðŸ¤– AI Provider Settings";
                font-size: 18px;
                font-weight: 600;
                horizontal-alignment: center;
            }

            Text {
                text: "Securely store your API keys.";
                font-size: 12px;
                color: Theme.text-secondary;
                horizontal-alignment: center;
            }

            HorizontalBox {
                Text {
                    text: "Provider:";
                    vertical-alignment: center;
                    width: 80px;
                }

                ComboBox {
                    width: 200px;
                    model: ["Anthropic", "OpenAI", "Gemini", "OpenRouter"];
                    current-value <=> root.ai-provider;
                    selected(value) => {
                        root.ai-provider-changed(value);
                    }
                }
            }

            HorizontalBox {
                Text {
                    text: "API Key:";
                    vertical-alignment: center;
                    width: 80px;
                }

                LineEdit {
                    placeholder-text: "Enter API Key";
                    input-type: password;
                    width: 200px;
                    text <=> root.ai-api-key;
                }
            }

            Text {
                text: root.ai-settings-status;
                color: Theme.accent;
                horizontal-alignment: center;
            }

            HorizontalBox {
                alignment: center;
                spacing: 16px;
                Button {
                    text: "Save Key";
                    width: 100px;
                    clicked => {
                        root.save-ai-key(root.ai-provider, root.ai-api-key);
                    }
                }

                Button {
                    text: "Close";
                    width: 100px;
                    clicked => {
                        root.close-ai-settings();
                    }
                }
            }
        }
    }
}
