import { Theme } from "styles.slint";
import { TitleBar } from "components/title_bar.slint";
import { MenuBar } from "components/menu_bar.slint";
import { RibbonToolbar } from "components/ribbon_toolbar.slint";
import { DocumentEditor } from "components/document_editor.slint";
import { StatusBar } from "components/status_bar.slint";
import { MenuDropdowns } from "components/menu_dropdowns.slint";
import { AISettingsPopup } from "components/ai_settings_popup.slint";
import { VerticalBox } from "std-widgets.slint";

export component MainWindowComprehensiveWindow inherits Window {
    title: "Herding Cats - Professional Word Processor";
    preferred-width: 1200px;
    preferred-height: 800px;
    min-width: 1000px;
    min-height: 700px;

    // Document and application state
    in-out property <string> document-title: "Untitled Document";
    in-out property <string> document-content: "";
    in-out property <string> status-message: "Ready";
    property <int> click-count: 0;
    property <bool> show-file-dropdown: false;
    property <bool> show-edit-dropdown: false;
    property <bool> show-view-dropdown: false;
    property <bool> show-tools-dropdown: false;
    property <bool> show-help-dropdown: false;
    property <bool> show-projects-dropdown: false;

    // Writing statistics
    in-out property <int> word-count: 0;
    in-out property <int> character-count: 0;
    in-out property <int> paragraph-count: 0;
    property <string> cursor-position: "Ln 1, Col 1";

    // Database connection status (kept for title bar)
    property <string> db-status: "Connected to Database";
    property <bool> db-connected: true;

    // Initialize with professional theme (handled by Theme global, but we can set it here if needed)
    init => {
        root.set-theme("Normal");
    }

    // Menu callbacks
    callback file-new();
    callback file-open();
    callback file-save();
    callback file-save-as();
    callback file-print();
    callback file-export();
    callback file-exit();

    // AI Settings
    in-out property <bool> show-ai-settings-popup: false;
    in-out property <string> ai-settings-status: "";
    in-out property <string> ai-provider: "Anthropic";
    in-out property <string> ai-api-key: "";
    callback open-ai-settings();
    callback save-ai-key(string, string);
    callback close-ai-settings();
    callback ai-provider-changed(string);

    callback edit-cut();
    callback edit-copy();
    callback edit-paste();
    callback edit-undo();
    callback edit-redo();
    callback edit-find();
    callback edit-replace();

    // Word Processing Callbacks
    callback format-bold();
    callback format-italic();
    callback format-underline();
    callback format-font();
    callback format-font-size();
    callback format-text-color();
    callback format-highlight();
    callback align-left();
    callback align-center();
    callback align-right();
    callback align-justify();
    callback insert-bullet-list();
    callback insert-numbered-list();
    callback open-style-gallery();

    callback view-toolbar();
    
    // Theme Callback
    callback set-theme(string);
    
    // Theme switching logic
    set-theme(theme-name) => {
        if (theme-name == "Normal") {
            Theme.primary-bg = #ffffff;
            Theme.secondary-bg = #f8f9fa;
            Theme.accent = #007bff;
            Theme.text-primary = #212529;
            Theme.text-secondary = #6c757d;
            Theme.border = #dee2e6;
            Theme.menu-bg = #f8f9fa;
            Theme.toolbar-bg = #ffffff;
            Theme.status-bg = #e9ecef;
            Theme.editor-bg = #ffffff;
            Theme.title-bg = #e9ecef;
            Theme.ribbon-bg = #f5f5f5;
            Theme.dropdown-bg = #ffffff;
        } else if (theme-name == "Warm") {
            Theme.primary-bg = #fdf6e3;
            Theme.secondary-bg = #eee8d5;
            Theme.accent = #cb4b16;
            Theme.text-primary = #586e75;
            Theme.text-secondary = #93a1a1;
            Theme.border = #d3cbb7;
            Theme.menu-bg = #eee8d5;
            Theme.toolbar-bg = #fdf6e3;
            Theme.status-bg = #eee8d5;
            Theme.editor-bg = #fdf6e3;
            Theme.title-bg = #eee8d5;
            Theme.ribbon-bg = #fdf6e3;
            Theme.dropdown-bg = #fdf6e3;
        } else if (theme-name == "CRT Green") {
            Theme.primary-bg = #0d1117;
            Theme.secondary-bg = #161b22;
            Theme.accent = #00ff00;
            Theme.text-primary = #00ff00;
            Theme.text-secondary = #008f00;
            Theme.border = #30363d;
            Theme.menu-bg = #161b22;
            Theme.toolbar-bg = #0d1117;
            Theme.status-bg = #161b22;
            Theme.editor-bg = #0d1117;
            Theme.title-bg = #161b22;
            Theme.ribbon-bg = #0d1117;
            Theme.dropdown-bg = #161b22;
        } else if (theme-name == "CRT Amber") {
            Theme.primary-bg = #1a1a1a;
            Theme.secondary-bg = #2b2b2b;
            Theme.accent = #ffb000;
            Theme.text-primary = #ffb000;
            Theme.text-secondary = #b37b00;
            Theme.border = #4d4d4d;
            Theme.menu-bg = #2b2b2b;
            Theme.toolbar-bg = #1a1a1a;
            Theme.status-bg = #2b2b2b;
            Theme.editor-bg = #1a1a1a;
            Theme.title-bg = #2b2b2b;
            Theme.ribbon-bg = #1a1a1a;
            Theme.dropdown-bg = #2b2b2b;
        }
    }
    callback view-statusbar();
    callback view-zoom();
    callback view-fullscreen();

    callback tools-database();
    callback tools-search();
    callback tools-research();
    callback tools-analysis();
    
    // Writing Tools Callbacks
    callback tools-hierarchy();
    callback tools-codex();
    callback tools-plot();
    callback tools-notes();
    callback tools-structure();
    callback tools-brainstorming();
    callback tools-font-manager();

    callback help-documentation();
    callback help-about();

    // Project management callbacks
    callback project-new();
    callback project-open();
    callback project-save();
    callback project-export();
    
    // Writing statistics callbacks
    callback update-writing-stats();

    VerticalBox {
        spacing: 0;

        TitleBar {
            db-status <=> root.db-status;
            db-connected <=> root.db-connected;
        }

        MenuBar {
            show-file-dropdown <=> root.show-file-dropdown;
            show-projects-dropdown <=> root.show-projects-dropdown;
            show-edit-dropdown <=> root.show-edit-dropdown;
            show-tools-dropdown <=> root.show-tools-dropdown;
            show-view-dropdown <=> root.show-view-dropdown;
            show-help-dropdown <=> root.show-help-dropdown;
            status-message <=> root.status-message;
        }

        RibbonToolbar {
            status-message <=> root.status-message;
            click-count <=> root.click-count;
            format-bold => {
                root.format-bold();
            }
            format-italic => {
                root.format-italic();
            }
            format-underline => {
                root.format-underline();
            }
            format-font => {
                root.format-font();
            }
            format-font-size => {
                root.format-font-size();
            }
            format-text-color => {
                root.format-text-color();
            }
            format-highlight => {
                root.format-highlight();
            }
            align-left => {
                root.align-left();
            }
            align-center => {
                root.align-center();
            }
            align-right => {
                root.align-right();
            }
            align-justify => {
                root.align-justify();
            }
            insert-bullet-list => {
                root.insert-bullet-list();
            }
            insert-numbered-list => {
                root.insert-numbered-list();
            }
            open-style-gallery => {
                root.open-style-gallery();
            }
            tools-database => {
                root.tools-database();
            }
        }

        DocumentEditor {
            document-title <=> root.document-title;
            document-content <=> root.document-content;
            update-writing-stats => {
                root.update-writing-stats();
            }
        }

        StatusBar {
            status-message <=> root.status-message;
            word-count <=> root.word-count;
            character-count <=> root.character-count;
            paragraph-count <=> root.paragraph-count;
            cursor-position <=> root.cursor-position;
        }
    }

    MenuDropdowns {
        show-file-dropdown <=> root.show-file-dropdown;
        show-projects-dropdown <=> root.show-projects-dropdown;
        show-edit-dropdown <=> root.show-edit-dropdown;
        show-tools-dropdown <=> root.show-tools-dropdown;
        show-view-dropdown <=> root.show-view-dropdown;
        show-help-dropdown <=> root.show-help-dropdown;

        file-new => {
            root.file-new();
        }
        file-open => {
            root.file-open();
        }
        file-save => {
            root.file-save();
        }
        file-save-as => {
            root.file-save-as();
        }
        file-print => {
            root.file-print();
        }
        file-export => {
            root.file-export();
        }
        file-exit => {
            root.file-exit();
        }
        open-ai-settings => {
            root.open-ai-settings();
        }

        edit-cut => {
            root.edit-cut();
        }
        edit-copy => {
            root.edit-copy();
        }
        edit-paste => {
            root.edit-paste();
        }
        edit-undo => {
            root.edit-undo();
        }
        edit-redo => {
            root.edit-redo();
        }
        edit-find => {
            root.edit-find();
        }
        edit-replace => {
            root.edit-replace();
        }

        view-toolbar => {
            root.view-toolbar();
        }
        view-statusbar => {
            root.view-statusbar();
        }
        view-zoom => {
            root.view-zoom();
        }
        view-fullscreen => {
            root.view-fullscreen();
        }
        set-theme(theme-name) => {
            root.set-theme(theme-name);
        }

        tools-hierarchy => {
            root.tools-hierarchy();
        }
        tools-codex => {
            root.tools-codex();
        }
        tools-plot => {
            root.tools-plot();
        }
        tools-notes => {
            root.tools-notes();
        }
        tools-structure => {
            root.tools-structure();
        }
        tools-brainstorming => {
            root.tools-brainstorming();
        }
        tools-search => {
            root.tools-search();
        }
        tools-research => {
            root.tools-research();
        }
        tools-analysis => {
            root.tools-analysis();
        }
        tools-font-manager => {
            root.tools-font-manager();
        }
        tools-database => {
            root.tools-database();
        }

        project-new => {
            root.project-new();
        }
        project-open => {
            root.project-open();
        }
        project-save => {
            root.project-save();
        }
        project-export => {
            root.project-export();
        }
    }

    AISettingsPopup {
        visible <=> root.show-ai-settings-popup;
        ai-settings-status <=> root.ai-settings-status;
        ai-provider <=> root.ai-provider;
        ai-api-key <=> root.ai-api-key;

        save-ai-key(provider, key) => {
            root.save-ai-key(provider, key);
        }
        close-ai-settings => {
            root.close-ai-settings();
        }
        ai-provider-changed(provider) => {
            root.ai-provider-changed(provider);
        }
    }
}
